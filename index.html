<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gerador de Recibo Profissional - ATIVA</title>
  
  <script src="jspdf.js"></script>

  <style>
    /* Paleta de Cores e Estilo Moderno (Baseado na Imagem de Design) */
    :root {
      --color-primary: #0056b3; /* Azul escuro principal */
      --color-light-gray: #f8f9fa; /* Fundo leve */
      --color-border: #ced4da; /* Cor da borda padrão */
      --color-shadow: rgba(0, 0, 0, 0.1);
    }

    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      background: var(--color-light-gray); 
      padding: 40px; 
      display: flex; 
      justify-content: center; 
    }
    
    .container { 
      width: 550px; /* Mais compacto para o estilo card */
      background: white; 
      padding: 40px; 
      box-shadow: 0 4px 12px var(--color-shadow); 
      border-radius: 10px; 
      text-align: center;
    }

    .logo {
      width: 150px;
      margin-bottom: 20px;
    }
    
    h2 { 
      margin-bottom: 30px; 
      color: #343a40;
      font-weight: 800;
    }
    
    .field-group { 
      margin-bottom: 25px; 
      text-align: left;
    }
    
    label { 
      font-size: 14px; 
      font-weight: 600; 
      color: #495057;
      display: block; 
      margin-bottom: 5px;
    }
    
    input, textarea { 
      width: 100%; 
      border: 1px solid var(--color-border); 
      border-radius: 5px;
      padding: 10px 12px; 
      font-size: 16px; 
      box-sizing: border-box; 
      transition: border-color 0.3s, box-shadow 0.3s;
    }

    input:focus, textarea:focus {
      border-color: var(--color-primary);
      box-shadow: 0 0 0 0.2rem rgba(0, 86, 179, 0.25); 
      outline: none;
    }
    
    textarea { 
      height: 100px; 
      resize: vertical; 
    }
    
    button { 
      margin-top: 30px; 
      padding: 14px 20px; 
      font-size: 18px; 
      font-weight: bold;
      cursor: pointer; 
      background: var(--color-primary); 
      color: white; 
      border: none; 
      border-radius: 5px; 
      width: 100%;
      box-shadow: 0 2px 4px var(--color-shadow);
      transition: background 0.3s, box-shadow 0.3s;
    }
    
    button:hover {
      background: #004085; 
      box-shadow: 0 4px 8px var(--color-shadow);
    }
    
    .alerta { 
      background-color: #f8d7da; 
      color: #721c24; 
      padding: 12px; 
      border: 1px solid #f5c6cb; 
      border-radius: 5px; 
      margin-bottom: 25px; 
      text-align: left;
      display: none; 
    }
  </style>
</head>
<body>
  <div class="container">

    <img src="logo.png" alt="Logo Ativa" class="logo" /> 
    <h2>GERADOR DE RECIBO</h2>

    <div id="alertaErro" class="alerta"></div>

    <div class="field-group">
      <label for="cliente">Nome ou Razão Social do Cliente (Recebemos do(a)):</label>
      <input id="cliente" type="text" placeholder="Ex: Hotel Village Campina Grande LTDA" />
    </div>

    <div class="field-group">
      <label for="cnpj">CNPJ/CPF:</label>
      <input id="cnpj" type="text" placeholder="Ex: 13.798.166/0001-47 (Opcional)" />
    </div>

    <div class="field-group">
      <label for="valor_total">Valor Total do Pedido (R$):</label>
      <input id="valor_total" type="text" placeholder="180,00" oninput="formatarMoeda(this); gerarExtensoAutomatica(this.value);" />
    </div>
    
    <div class="field-group">
      <label for="valor_extenso">Importância por Extenso (Automático):</label>
      <input id="valor_extenso" type="text" placeholder="Ex: CENTO E OITENTA REAIS" readonly />
    </div>


    <div class="field-group">
      <label for="descricao">Descrição Detalhada do Pedido (Referente a):</label>
      <textarea id="descricao" placeholder="Liste os serviços/produtos, valores unitários e totais.&#10;Ex: 40 Folhetos | R$2,00/und | R$80,00"></textarea>
    </div>

    <div class="field-group">
      <label for="data">Data de Emissão do Recibo:</label>
      <input id="data" type="date" />
    </div>

    <button onclick="gerarPDF()">Gerar Recibo em PDF</button>
  </div>

<script>
// ===========================================
// FUNÇÕES DE VALOR E FORMATAÇÃO
// ===========================================

function formatarMoeda(input) {
  let v = input.value.replace(/\D/g, "");
  if (!v) { input.value = ""; return; }
  v = (v / 100).toFixed(2) + '';
  v = v.replace('.', ',');
  input.value = 'R$ ' + v;
}

function formatarData(dataString) {
  if (!dataString) return "";
  const [ano, mes, dia] = dataString.split('-');
  return `${dia}/${mes}/${ano}`;
}

// Função de conversão automática (o novo recurso)
function gerarExtensoAutomatica(valorFormatado) {
  // Remove "R$" e formatação para obter o número limpo (ex: "180,00")
  const valorLimpo = valorFormatado.replace('R$', '').trim().replace('.', '').replace(',', '.');
  const valorNumerico = parseFloat(valorLimpo);

  if (isNaN(valorNumerico) || valorNumerico <= 0) {
    document.getElementById("valor_extenso").value = "";
    return;
  }
  
  const extenso = valorPorExtenso(valorNumerico);
  document.getElementById("valor_extenso").value = extenso.toUpperCase(); // Mantém em CAIXA ALTA
}

// Lógica para converter número para extenso em Português (adaptada para centavos)
function valorPorExtenso(v) {
  const unidade = ['', 'UM', 'DOIS', 'TRÊS', 'QUATRO', 'CINCO', 'SEIS', 'SETE', 'OITO', 'NOVE'];
  const dezena = ['', 'DEZ', 'VINTE', 'TRINTA', 'QUARENTA', 'CINQUENTA', 'SESSENTA', 'SETENTA', 'OITENTA', 'NOVENTA'];
  const especial = ['DEZ', 'ONZE', 'DOZE', 'TREZE', 'CATORZE', 'QUINZE', 'DEZESSEIS', 'DEZESSETE', 'DEZOITO', 'DEZENOVE'];
  const centena = ['', 'CENTO', 'DUZENTOS', 'TREZENTOS', 'QUATROCENTOS', 'QUINHENTOS', 'SEISCENTOS', 'SETECENTOS', 'OITOCENTOS', 'NOVECENTOS'];

  function porExtenso(n) {
    if (n === 0) return '';
    if (n < 10) return unidade[n];
    if (n >= 10 && n <= 19) return especial[n - 10];
    if (n >= 20 && n <= 99) {
      return dezena[Math.floor(n / 10)] + (n % 10 !== 0 ? ' E ' + unidade[n % 10] : '');
    }
    if (n >= 100 && n <= 999) {
      if (n === 100) return 'CEM';
      return centena[Math.floor(n / 100)] + (n % 100 !== 0 ? ' E ' + porExtenso(n % 100) : '');
    }
    if (n >= 1000 && n <= 999999) {
      const milhares = Math.floor(n / 1000);
      const resto = n % 1000;
      let result = porExtenso(milhares) + (milhares === 1 ? ' MIL' : ' MIL');
      if (resto !== 0) {
        result += (resto < 100 ? ' E ' : ', ') + porExtenso(resto);
      }
      return result;
    }
    if (n >= 1000000 && n <= 999999999) {
      const milhoes = Math.floor(n / 1000000);
      const resto = n % 1000000;
      let result = porExtenso(milhoes) + (milhoes === 1 ? ' MILHÃO' : ' MILHÕES');
      if (resto !== 0) {
        result += (resto < 100000 ? ' E ' : ', ') + porExtenso(resto);
      }
      return result;
    }
    return '';
  }

  const partes = v.toFixed(2).split('.');
  const inteiros = parseInt(partes[0]);
  const centavos = parseInt(partes[1]);
  let resultado = '';

  // Converte a parte inteira (Reais)
  if (inteiros > 0) {
    resultado = porExtenso(inteiros) + (inteiros === 1 ? ' REAL' : ' REAIS');
  }

  // Converte a parte decimal (Centavos)
  if (centavos > 0) {
    const extensoCentavos = porExtenso(centavos) + (centavos === 1 ? ' CENTAVO' : ' CENTAVOS');
    if (resultado !== '') {
      resultado += ' E ';
    }
    resultado += extensoCentavos;
  }

  return resultado;
}

// ===========================================
// GERAÇÃO DO PDF
// ===========================================

function gerarPDF() {
  // --- Coleta de Dados ---
  const cliente = document.getElementById("cliente").value.trim();
  const cnpj = document.getElementById("cnpj").value.trim();
  const valor_extenso = document.getElementById("valor_extenso").value.trim().toUpperCase();
  const descricao = document.getElementById("descricao").value.trim();
  const valor_total_input = document.getElementById("valor_total").value.trim();
  const dataInput = document.getElementById("data").value;
  const alerta = document.getElementById("alertaErro");

  // --- Validação ---
  let erros = [];
  if (!cliente) erros.push("Cliente");
  if (!valor_extenso) erros.push("Importância por extenso");
  if (!descricao) erros.push("Descrição do pedido");
  if (!valor_total_input || valor_total_input === 'R$ 0,00') erros.push("Valor Total");
  if (!dataInput) erros.push("Data");

  if (erros.length > 0) {
    alerta.innerHTML = `⚠️ Por favor, preencha os seguintes campos: <b>${erros.join(', ')}</b>.`;
    alerta.style.display = 'block';
    return;
  }
  alerta.style.display = 'none';

  // --- Preparação para o PDF ---
  const dataFormatada = formatarData(dataInput);
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF({ 
    unit: "pt", 
    format: "a4" 
  });

  const img = new Image();
  img.src = 'recibo_modelo.jpg'; // *** ARQUIVO DE FUNDO NOVO: .JPG ***

  // --- Geração do Conteúdo ---
  img.onload = function() {
    const pageW = pdf.internal.pageSize.getWidth();
    
    // 1. Adiciona a imagem de fundo em tela cheia (A4)
    pdf.addImage(img, 'JPEG', 0, 0, pageW, 841.89);

    // 2. Configurações de Texto Padrão
    pdf.setFont("Helvetica", "normal");
    pdf.setTextColor(0); 

    // =========================================
    //      COORDENADAS FINAIS AJUSTADAS (2025-12-04)
    // =========================================
    
    // Valor Total (em cima, à direita)
    pdf.setFontSize(14);
    pdf.setFont("Helvetica", "bold");
    // X: 560 (quase no canto direito, após "R$") | Y: 114
    pdf.text(valor_total_input.replace('R$', '').trim(), 560, 114, { align: 'right' }); 
    
    // Cliente (Nome/Razão Social)
    pdf.setFontSize(11);
    pdf.setFont("Helvetica", "normal");
    // X: 135 (após "Recebemos do(a)") | Y: 185
    pdf.text(cliente, 135, 185); 

    // CNPJ
    // X: 455 (após "CNPJ:") | Y: 185
    pdf.text(cnpj, 455, 185); 

    // Valor por Extenso (A importância de R$)
    pdf.setFontSize(11);
    pdf.setFont("Helvetica", "bold"); 
    // X: 165 (após "A importância de R$") | Y: 215
    pdf.text(valor_extenso, 165, 215); 

    // Descrição (Referente a) - 450pt de largura máxima
    pdf.setFontSize(11);
    pdf.setFont("Helvetica", "normal");
    const splitDescription = pdf.splitTextToSize(descricao, 450); 
    // X: 125 (após "Referente a") | Y: 245
    pdf.text(splitDescription, 125, 245); 
    
    // Data (embaixo, centralizado)
    pdf.setFontSize(11);
    // X: 480 (após "Campina Grande, / ") | Y: 698
    pdf.text(dataFormatada, 480, 698); 

    // --- Salva o PDF ---
    pdf.save(`Recibo_Ativa_${cliente.replace(/\s/g, '_')}_${dataFormatada.replace(/\//g, '-')}.pdf`);
  };

  // --- Tratamento de Erro de Imagem ---
  img.onerror = function() {
    alerta.innerHTML = "⚠️ ERRO GRAVE: O arquivo 'recibo_modelo.jpg' não foi encontrado! O PDF não pode ser gerado no design original.";
    alerta.style.display = 'block';
  };
}
</script>
</body>
</html>